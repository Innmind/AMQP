arguments:
    transport: Innmind\Socket\Internet\Transport
    server: Innmind\Url\UrlInterface
    timeout: Innmind\TimeContinuum\ElapsedPeriod
    clock: Innmind\TimeContinuum\TimeContinuumInterface
    logger: Psr\Log\LoggerInterface
    protocols: set<Innmind\AMQP\Transport\Protocol> ?? $protocol.defaults
    argumentTranslators: set<Innmind\AMQP\Transport\Protocol\ArgumentTranslator> ?? $protocol.argumentTranslator.defaults
    consumers: '?map<string, callable>'
    exchanges: '?set<Innmind\AMQP\Model\Exchange\Declaration>'
    queues: '?set<Innmind\AMQP\Model\Queue\Declaration>'
    bindings: '?set<Innmind\AMQP\Model\Queue\Binding>'

expose:
    client: '$client.signalAware'
    basic: '$client.default'
    autoDeclare: '$client.autoDeclare'
    purgeCommand: '$command.purge'
    getCommand: '$command.get'
    consumeCommand: '$command.consume'
    producers: '$producers'

services:
    client:
        default Innmind\AMQP\Client\Client:
            - '$connection.logger'

        fluent Innmind\AMQP\Client\Fluent:
            - '$client.default'

        logger Innmind\AMQP\Client\Logger:
            - '$client.fluent'
            - '$logger'

        signalAware Innmind\AMQP\Client\SignalAware:
            - '$client.logger'

        autoDeclare Innmind\AMQP\Client\AutoDeclare:
            - '$client.signalAware'
            - '$exchanges'
            - '$queues'
            - '$bindings'

    connection:
        lazy Innmind\AMQP\Transport\Connection\Lazy:
            - '$transport'
            - '$server'
            - '$protocol.delegate'
            - '$timeout'
            - '$clock'

        logger Innmind\AMQP\Transport\Connection\Logger:
            - '$connection.lazy'
            - '$logger'

    protocol:
        delegate Innmind\AMQP\Transport\Protocol\Delegate:
            - '...$protocols'

        v091 Innmind\AMQP\Transport\Protocol\v091\Protocol:
            - '$protocol.argumentTranslator.delegate'

        defaults set<Innmind\AMQP\Transport\Protocol>:
            - '$protocol.v091'

        argumentTranslator:
            delegate Innmind\AMQP\Transport\Protocol\ArgumentTranslator\Delegate:
                - '...$argumentTranslators'

            value Innmind\AMQP\Transport\Protocol\ArgumentTranslator\ValueTranslator: []

            defaults set<Innmind\AMQP\Transport\Protocol\ArgumentTranslator>:
                - '$protocol.argumentTranslator.value'

    queueConsumers Innmind\AMQP\Consumers:
        - $consumers

    command:
        purge Innmind\AMQP\Command\Purge:
            - $client.autoDeclare

        get Innmind\AMQP\Command\Get:
            - $client.autoDeclare
            - $queueConsumers

        consume Innmind\AMQP\Command\Consume:
            - $client.autoDeclare
            - $queueConsumers

    producers Innmind\AMQP\Producers::fromDeclarations:
        - '$client.autoDeclare'
        - '...$exchanges'
